<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sizing Guide: The VRAM Math :: Intelligent Model Deployment with llm-d</title>
    <link rel="prev" href="section1.html">
    <link rel="next" href="section3.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Intelligent Model Deployment with llm-d</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhoai3-deploy" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Intelligent Model Deployment with llm-d</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Introduction &amp; Value</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section1.html">Architecture Deep Dive</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="section2.html">The Deployment Lab</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section3.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Introduction &amp; Value</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section1.html">GPU Architecture</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="section2.html">The Sizing Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section3.html">vLLM</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section4.html">vLLM Tuning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section5.html">Deploy a Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="section6.html">Testing</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Intelligent Model Deployment with llm-d</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Intelligent Model Deployment with llm-d</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Intelligent Model Deployment with llm-d</a></li>
    <li><a href="section2.html">The Deployment Lab</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Sizing Guide: The VRAM Math</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p><strong>Inference fails for one reason: Out of Memory (OOM).</strong></p>
</div>
<div class="paragraph">
<p>A common mistake is looking at a model&#8217;s file size (e.g., "15GB") and assuming it will fit on a 16GB GPU.
It won&#8217;t.
To size an inference node correctly, you must account for the <strong>Model Weights</strong> (static) and the <strong>KV Cache</strong> (dynamic).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_formula"><a class="anchor" href="#_the_formula"></a>The Formula</h2>
<div class="sectionbody">
<div class="stemblock">
<div class="content">
\$Total VRAM = (Weights \times 1.2) + (KV Cache)\$
</div>
</div>
<div class="sect2">
<h3 id="_part_1_the_static_cost_model_weights"><a class="anchor" href="#_part_1_the_static_cost_model_weights"></a>Part 1: The Static Cost (Model Weights)</h3>
<div class="paragraph">
<p>This is the "rent" you pay just to turn the model on.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Formula:</strong> <code>Params (Billions) * Size_Per_Param</code></p>
</li>
<li>
<p><strong>Size Guide:</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>FP16 (Standard):</strong> 2 Bytes per param.</p>
</li>
<li>
<p><strong>FP8 / INT8:</strong> 1 Byte per param.</p>
</li>
<li>
<p><strong>AWQ (INT4):</strong> 0.5 Bytes per param.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example: Granite-8B (FP16)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">8 Billion * 2 Bytes = 16 GB
Overhead (CUDA Kernels) = +20%
---------------------------
Static Footprint = ~19.2 GB</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Result:</strong> This fits on an <strong>A10G (24GB)</strong>, but fails on a <strong>T4 (16GB)</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_the_dynamic_cost_kv_cache"><a class="anchor" href="#_part_2_the_dynamic_cost_kv_cache"></a>Part 2: The Dynamic Cost (KV Cache)</h3>
<div class="paragraph">
<p>This is the "variable cost" of your user traffic.
Every token generated for every user consumes VRAM. If you run out, the server crashes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Key Variables:</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Context Length:</strong> How much history the model remembers (e.g., 4k vs 128k tokens).</p>
</li>
<li>
<p><strong>Batch Size:</strong> How many concurrent users you serve.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>The Danger Zone:</strong>
A <strong>Granite-8B</strong> model supports a 128k context window.
If you simply deploy it with defaults, vLLM effectively tries to reserve space for that full 128k window.
<strong>128k Context @ FP16 = ~20 GB of VRAM.</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">The OOM Trap</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Static Footprint (19.2 GB) + Full Context (20 GB) = 39.2 GB
---
Hardware Available (A10G) = 24 GB
Result: CRASH (OOMKilled)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_engineering_fix_cap_the_context"><a class="anchor" href="#_the_engineering_fix_cap_the_context"></a>The Engineering Fix: Cap the Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You cannot magically download more VRAM. You must compromise.
By limiting the context window, you reserve room for the model to breathe.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>The Parameter:</strong> <code>--max-model-len</code></p>
</li>
<li>
<p><strong>The Math:</strong> Reducing context from 128k to <strong>8k</strong> drops the KV Cache requirement from ~20GB to <strong>~1.5GB</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Optimized Deployment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Static (19.2 GB) + Limited Cache (1.5 GB) = 20.7 GB
---
Fits safely on 24GB Card.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_reference_will_it_fit"><a class="anchor" href="#_quick_reference_will_it_fit"></a>Quick Reference: "Will It Fit?"</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Assumes <strong>FP16</strong> precision.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Model</th>
<th class="tableblock halign-left valign-top">Min VRAM (Weights)</th>
<th class="tableblock halign-left valign-top">Min Card (Idle)</th>
<th class="tableblock halign-left valign-top">Recommended Card (Production)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Granite-2B</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~4 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NVIDIA T4 (16GB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NVIDIA L4 (24GB)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Granite-8B</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~16 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NVIDIA A10G (24GB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NVIDIA A100 (40GB) or L40S</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Llama-3-70B</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~140 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2x A100 (80GB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4x A100 or 2x H100</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#vllm-tuning.adoc" class="xref unresolved">Next: Tuning the Engine</a></p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="section1.html">Architecture Deep Dive</a></span>
  <span class="next"><a href="section3.html">Troubleshooting</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
